<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rigatoni • Rigatoni</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Rigatoni">
<meta property="og:description" content="Rigatoni">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rigatoni</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Rigatoni.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Rigatoni</h1>
            
      
      
      <div class="hidden name"><code>Rigatoni.Rmd</code></div>

    </div>

    
    
<p>Load the package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Rigatoni</span><span class="op">)</span></code></pre></div>
<p>Set your working directory</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">"/path/to/the/directory/that/contains/images/to/analyse"</span><span class="op">)</span></code></pre></div>
<div id="working-on-a-single-image" class="section level2">
<h2 class="hasAnchor">
<a href="#working-on-a-single-image" class="anchor"></a>Working on a single image</h2>
<p>We will use the <code>peanut_pod.jpg</code> example image that is provided as part of the package. This is peanut pods acquired on a flat bed scanner with a green background.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"peanut_pod.jpg"</span>, package<span class="op">=</span><span class="st">"Rigatoni"</span><span class="op">)</span>
<span class="va">img</span> <span class="op">=</span> <span class="fu">readImage</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="fu">display</span><span class="op">(</span><span class="va">img</span>, method<span class="op">=</span><span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="Rigatoni_files/figure-html/unnamed-chunk-3-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The first thing to do is to get a range of color (hue) values for the background of the image that will be further used for applying a color threshold.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mythreshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_huethr_values.html">get_huethr_values</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
<span class="va">mythreshold</span></code></pre></div>
<p>The <code>get_huethr_values</code> function allows to click twice on the distribution. On the example below, the second peak represents the background. Click on both sides of the peak will return a vector of 2 values. <img src="Rigatoni_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<pre><code>#&gt; [1] 60 90</code></pre>
<p>Once the hue threshold values are determined it can be used to find features in the image using the <code>krnel</code> function</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pods</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/krnel.html">krnel</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">img</span>,
            resizw <span class="op">=</span> <span class="fl">1000</span>,
            huethres <span class="op">=</span> <span class="va">mythreshold</span>, 
            minsize <span class="op">=</span> <span class="fl">200</span>,
            maxsize <span class="op">=</span> <span class="fl">20000</span>,
            save.outline <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>Note that the <code>img</code> parameter can either be an Image object previously obtained with <code><a href="https://rdrr.io/pkg/EBImage/man/io.html">EBImage::readImage</a></code> or the name of an image file that is in your working directory (or it’s full patch if located elsewhere).<br>
The <code>resizw</code> parameter allows to reduce image size by providing the width of the image that will be analyzed (height will be modified accordingly to respect h/w ratio). Reducing the size of the image improves the performance of features detection and is important when many images need to be analysed sequentially.<br>
The <code>minsize</code> and <code>maxsize</code> parameters allow to fix the minimum and maximum size (area) of the objects that will be captured in the image. Note that the two parameters are expressed relatively to the resized image.</p>
<p>The object that is returned by the <code>krnel</code> function is of S3 class.. <code>krnel</code><br>
It is a list with four components:</p>
<ul>
<li><p>features : a data.frame with as many rows as the number of detected features and description variables as returned by <code><a href="https://rdrr.io/pkg/EBImage/man/computeFeatures.html">EBImage::computeFeatures</a></code>. It also includes bounding box width and height aka Feret min and max diameter.</p></li>
<li><p>contours : a list with as many elements as the number of detected features Each element is a matrix with the coordinates of each feature.</p></li>
<li><p>bbox : a list with as many elements as the number of detected features. Each element is a list with 4 components: <code>$pts</code> that contains the coordinates of each corner of the bounding box, <code>$width</code>, <code>$height</code>, and <code>$angle</code></p></li>
<li><p>params : a list with the analysis parameters. can be used for further plotting</p></li>
</ul>
<p>The features of the <code>pods</code> object can be plotted with the plot function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">pods</span>,
     plot.bbox<span class="op">=</span><span class="cn">T</span>,
     plot.radii <span class="op">=</span> <span class="cn">F</span>,
     plot.ellipse <span class="op">=</span> <span class="cn">F</span>,
     plot.ws.pois <span class="op">=</span> <span class="cn">F</span>,
     plot.pois <span class="op">=</span> <span class="cn">F</span>,
     label.cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="Rigatoni_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can see that object #11 is the merger of two pods that were not separated on the scanner.<br>
This artecfactual object can be excluded by decreasing <code>maxsize</code>.<br>
Let’s decrease it to 10000.</p>
<p>We can also set <code>save.outline</code> to <code>TRUE</code> so that the analysed image will be saved in the same directory with detected objects outlines.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pods</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/krnel.html">krnel</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">img</span>,
            resizw <span class="op">=</span> <span class="fl">1000</span>,
            huethres <span class="op">=</span> <span class="va">mythreshold</span>,
            minsize <span class="op">=</span> <span class="fl">200</span>,
            maxsize <span class="op">=</span> <span class="fl">10000</span>,
            save.outline <span class="op">=</span> <span class="cn">T</span>,
            img.name <span class="op">=</span> <span class="st">"peanut_pod"</span><span class="op">)</span></code></pre></div>
<p><img src="Rigatoni_files/figure-html/unnamed-chunk-9-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The resulting <code>pods</code> object no longer contains the 2 non separated pods.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">pods</span>,
     plot.bbox <span class="op">=</span> <span class="cn">T</span>,
     plot.radii <span class="op">=</span> <span class="cn">F</span>,
     plot.ellipse <span class="op">=</span> <span class="cn">F</span>,
     plot.ws.pois <span class="op">=</span> <span class="cn">F</span>,
     plot.pois <span class="op">=</span> <span class="cn">F</span>,
     label.cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="Rigatoni_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Another, and recommended, option is to use the <code>watershed</code> parameter.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pods</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/krnel.html">krnel</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">img</span>, 
            resizw <span class="op">=</span> <span class="fl">1000</span>, 
            huethres <span class="op">=</span> <span class="va">mythreshold</span>, 
            minsize <span class="op">=</span> <span class="fl">200</span>, 
            maxsize <span class="op">=</span> <span class="fl">20000</span>, 
            save.outline <span class="op">=</span> <span class="cn">F</span>, 
            watershed <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">pods</span>,
     plot.bbox <span class="op">=</span> <span class="cn">T</span>,
     plot.radii <span class="op">=</span> <span class="cn">F</span>,
     plot.ellipse <span class="op">=</span> <span class="cn">F</span>,
     plot.ws.pois <span class="op">=</span> <span class="cn">F</span>,
     plot.pois <span class="op">=</span> <span class="cn">F</span>,
     label.cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="Rigatoni_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="working-on-many-images" class="section level2">
<h2 class="hasAnchor">
<a href="#working-on-many-images" class="anchor"></a>Working on many images</h2>
<p>If your working directory contains many images it is possible to analyse several or all of them at a time.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".*.jpg$"</span><span class="op">)</span>
<span class="co">#or files &lt;- c("file1.jpg", "file2.jpg", "file3.jpg")</span></code></pre></div>
<p>To apply the <code>krnel</code> function to all the files listed in <code>files</code> and get the result in a list, we can use the lapply function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">img_pods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">files</span>,
                   <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu"><a href="../reference/krnel.html">krnel</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">a</span>,
                                     resizw <span class="op">=</span> <span class="fl">1000</span>,
                                     huethres <span class="op">=</span> <span class="va">mythreshold</span>,
                                     minsize <span class="op">=</span> <span class="fl">100</span>,
                                     maxsize <span class="op">=</span> <span class="fl">10000</span>,
                                     save.outline <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
                   <span class="op">)</span></code></pre></div>
<p>We thus get a list of krnel objects. Let’s name the components of the list with image names.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">img_pods</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">files</span></code></pre></div>
<p>To extract all features of all images into a single data.table with an extra column containing the name of the images :</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">i</span><span class="op">)</span> <span class="fu">data.table</span><span class="op">(</span>Image<span class="op">=</span><span class="va">i</span>, <span class="va">a</span><span class="op">$</span><span class="va">features</span><span class="op">)</span>,
                            <span class="va">img_pods</span>,
                            <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">img_pods</span><span class="op">)</span>
                            <span class="op">)</span>
                        <span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by J-F Rami.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
